
- platform: time_date
  display_options:
    - 'time'
    - 'date'
    - 'date_time'
    - 'time_date'
    - 'time_utc'
    - 'beat'


- platform: yr
  name: Weather
  # forecast: 24
  monitored_conditions:
    - temperature
    - symbol
    - precipitation
    - windSpeed
    - pressure
    - windDirection
    - humidity
    - fog
    - cloudiness
    - lowClouds
    - mediumClouds
    - highClouds
    - dewpointTemperature


- platform: template
  sensors:
    away_mode:
      value_template: "{{ states.climate.hallway.attributes.away_mode }}"


- platform: template
  sensors:
    next_sun_event:
      value_template: >-
        {% set next_time = 86400 %}
        {% if as_timestamp(states.sun.sun.attributes.next_noon) - as_timestamp(now()) < next_time %}
        {% set next_time = as_timestamp(states.sun.sun.attributes.next_noon) - as_timestamp(now()) %}
        {% set next_event = 'noon' %}
        {% endif %}
        {% if as_timestamp(states.sun.sun.attributes.next_setting) - as_timestamp(now()) < next_time %}
        {% set next_time = as_timestamp(states.sun.sun.attributes.next_setting) - as_timestamp(now()) %}
        {% set next_event = 'setting' %}
        {% endif %}
        {% if as_timestamp(states.sun.sun.attributes.next_dusk) - as_timestamp(now()) < next_time %}
        {% set next_time = as_timestamp(states.sun.sun.attributes.next_dusk) - as_timestamp(now()) %}
        {% set next_event = 'dusk' %}
        {% endif %}
        {% if as_timestamp(states.sun.sun.attributes.next_midnight) - as_timestamp(now()) < next_time %}
        {% set next_time = as_timestamp(states.sun.sun.attributes.next_midnight) - as_timestamp(now()) %}
        {% set next_event = 'midnight' %}
        {% endif %}
        {% if as_timestamp(states.sun.sun.attributes.next_dawn) - as_timestamp(now()) < next_time %}
        {% set next_time = as_timestamp(states.sun.sun.attributes.next_dawn) - as_timestamp(now()) %}
        {% set next_event = 'dawn' %}
        {% endif %}
        {% if as_timestamp(states.sun.sun.attributes.next_rising) - as_timestamp(now()) < next_time %}
        {% set next_time = as_timestamp(states.sun.sun.attributes.next_rising) - as_timestamp(now()) %}
        {% set next_event = 'rising' %}
        {% endif %}
        {{ next_event }}


# preferred_light_profile example:
# dawn to rising   : 6:48 am  to 7:19 am  : energize
# rising to noon   : 7:19 am  to 12:17 pm : energize
# noon to setting  : 12:17 pm to 5:14 pm  : concentrate
# setting to dusk  : 5:14 pm  to 5:45 pm  : concentrate
# dusk to midnight : 5:45 pm  to 12:17 am : read
# midnight to dawn : 12:17 am to 6:48 am  : relax

- platform: template
  sensors:
    preferred_light_profile:
      value_template: >-
        {% if is_state('sensor.next_sun_event','dawn') %}
        relax
        {% elif is_state('sensor.next_sun_event','rising') %}
        energize
        {% elif is_state('sensor.next_sun_event','noon') %}
        energize
        {% elif is_state('sensor.next_sun_event','setting') %}
        concentrate
        {% elif is_state('sensor.next_sun_event','dusk') %}
        concentrate
        {% elif is_state('sensor.next_sun_event','midnight') %}
        read
        {% endif %}


- platform: template
  sensors:
    preferred_light_color_temp:
      value_template: >-
        {% if is_state('sensor.next_sun_event','dawn') %}
        443
        {% elif is_state('sensor.next_sun_event','rising') %}
        156
        {% elif is_state('sensor.next_sun_event','noon') %}
        156
        {% elif is_state('sensor.next_sun_event','setting') %}
        230
        {% elif is_state('sensor.next_sun_event','dusk') %}
        230
        {% elif is_state('sensor.next_sun_event','midnight') %}
        343
        {% endif %}


- platform: template
  sensors:
    preferred_light_brightness:
      value_template: >-
        {% if is_state('sensor.next_sun_event','dawn') %}
        144
        {% elif is_state('sensor.next_sun_event','rising') %}
        254
        {% elif is_state('sensor.next_sun_event','noon') %}
        254
        {% elif is_state('sensor.next_sun_event','setting') %}
        254
        {% elif is_state('sensor.next_sun_event','dusk') %}
        254
        {% elif is_state('sensor.next_sun_event','midnight') %}
        254
        {% endif %}


- platform: template
  sensors:
    living_room_light_profile:
      value_template: >-
        {% if states.light.living_room.attributes.xy_color == [0.3146,0.3304] %}
        energize
        {% elif states.light.living_room.attributes.xy_color == [0.3682,0.3715] %}
        concentrate
        {% elif states.light.living_room.attributes.xy_color == [0.4452,0.4068] %}
        read
        {% elif states.light.living_room.attributes.xy_color == [0.5014,0.4153] %}
        relax
        {% else %}
        none
        {% endif %}


- platform: template
  sensors:
    family_room_light_profile:
      value_template: >-
        {% if states.light.family_room.attributes.xy_color == [0.3146,0.3304] %}
        energize
        {% elif states.light.family_room.attributes.xy_color == [0.3682,0.3715] %}
        concentrate
        {% elif states.light.family_room.attributes.xy_color == [0.4452,0.4068] %}
        read
        {% elif states.light.family_room.attributes.xy_color == [0.5014,0.4153] %}
        relax
        {% else %}
        none
        {% endif %}


- platform: template
  sensors:
    outside_light_profile:
      value_template: >-
        {% if states.light.outside.attributes.xy_color == [0.3146,0.3304] %}
        energize
        {% elif states.light.outside.attributes.xy_color == [0.3682,0.3715] %}
        concentrate
        {% elif states.light.outside.attributes.xy_color == [0.4452,0.4068] %}
        read
        {% elif states.light.outside.attributes.xy_color == [0.5014,0.4153] %}
        relax
        {% else %}
        none
        {% endif %}


- platform: template
  sensors:
    master_bedroom_light_profile:
      value_template: >-
        {% if states.light.master_bedroom.attributes.color_temp == 156 %}
        energize
        {% elif states.light.master_bedroom.attributes.color_temp == 230 %}
        concentrate
        {% elif states.light.master_bedroom.attributes.color_temp == 343 %}
        read
        {% elif states.light.master_bedroom.attributes.color_temp == 443 %}
        relax
        {% else %}
        none
        {% endif %}